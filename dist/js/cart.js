$(function(){if($.cookie("PHPSESSID"))$.ajax({url:"http://127.0.0.1/zol/server/php/cart.php",type:"post",dataType:"json"}).then(function(t){var a=0;$(".price p em").text(t.length);for(var i=t,s=i.length-1;s>=0;s--){$('<tr data-info="'+i[s].cart_id+'" data-id="'+i[s].id+'"><td class="good"><img src="images/img/'+i[s].img_list+'" alt=""><div><a href="#">'+i[s].name+"</a><p>颜色："+i[s].cart_color+"</p><p>  套装："+i[s].cart_suit+'</p></div></td><td class="price">'+i[s].price+'</td><td class="num"><a href="javascript:void(0)">-</a><span>'+i[s].cart_num+'</span><a href="javascript:void(0)">+</a></td><td> --</td><td class="money">'+i[s].cart_num*i[s].price+'</td><td class="caozuo"><a href="javascript:void(0)" class="remove">删除</a></td></tr>').appendTo($("#tab")),a+=parseInt(i[s].cart_num)*parseInt(i[s].price)}$(".remove").on("click",function(){var t=$(this).parents("tr").data("info");$(this).parents("tr").remove(),$.ajax({url:"http://127.0.0.1/zol/server/php/remove.php",type:"post",dataType:"json",data:{id:t}}),alert("操作成功"),$(".price p em").text(Number($(".cart span").text())-1),$(".cart span").text(Number($(".cart span").text())-1)}),$(".good").on("click",function(){window.location.href="http://127.0.0.1/zol/src/info.html?id="+$(this).parents("tr").data("id")}),$("#tab .num").find("a:first").on("click",function(){$(this).siblings("span").text($(this).siblings("span").text()<=1?1:$(this).siblings("span").text()-1);var t=$(this).parents("tr").data("info");$.ajax({url:"http://127.0.0.1/zol/server/php/remove.php",type:"post",dataType:"json",data:{id:t,num:$(this).siblings("span").text()}})}),$("#tab .num").find("a:last").on("click",function(){$(this).siblings("span").text(Number($(this).siblings("span").text())+1);var t=$(this).parents("tr").data("info");$.ajax({url:"http://127.0.0.1/zol/server/php/remove.php",type:"post",dataType:"json",data:{id:t,num:$(this).siblings("span").text()}})}),$(".price p span i").text(a),$(".list .total span").text("￥"+a)});else{var t=JSON.parse($.cookie("list")||"[]"),a=0;$(".price p em").text(t.length);for(var i=t.length-1;i>=0;i--){$('<tr data-info="" data-id="'+t[i].id+'"><td class="good"><img src="" alt=""><div><a href="#"></a><p>颜色：'+t[i].color+"</p><p>  套装："+t[i].suit+'</p></div></td><td class="price"></td><td class="num"><a href="javascript:void(0)">-</a><span>'+t[i].num+'</span><a href="javascript:void(0)">+</a></td><td> --</td><td class="money"></td><td class="caozuo"><a href="javascript:void(0)" class="remove">删除</a></td></tr>').appendTo($("#tab")),$.ajax({url:"http://127.0.0.1/zol/server/php/list.php",type:"post",dataType:"json",data:{id:t[i].id}}).then(function(t){$("#tab tr[data-id="+t[0].id+"] .good img").attr("src","images/img/"+t[0].img_list),$("#tab tr[data-id="+t[0].id+"] .good a").text(t[0].name),$("#tab tr[data-id="+t[0].id+"] .price").text(t[0].price),a+=Number(t[0].price)*Number($("#tab tr[data-id="+t[0].id+"] .num span").text()),$("#tab tr[data-id="+t[0].id+"] .money").text(Number(t[0].price)*Number($("#tab tr[data-id="+t[0].id+"] .num span").text())),$(".price p span i").text(a),$(".list .total span").text("￥"+a)})}$(".remove").on("click",function(){var t=$(this).parents("tr").data("id");$(this).parents("tr").remove();for(var a=JSON.parse($.cookie("list")),i=0;i<a.length;i++)a[i].id==t&&a.splice(i,1);alert("操作成功"),$(".cart span").text(a.length),$(".price p em").text(a.length),$.cookie("list",JSON.stringify(a))}),$(".good").on("click",function(){window.location.href="http://127.0.0.1/zol/src/info.html?id="+$(this).parents("tr").data("id")}),$("#tab .num").find("a").eq(0).on("click",function(){$(this).siblings("span").text($(this).siblings("span").text()<=1?1:$(this).siblings("span").text()-1);for(var t=JSON.parse($.cookie("list")),a=0;a<t.length;a++)t[a].id==$(this).parents("tr").data("id")&&(t[a].num=$(this).siblings("span").text());$.cookie("list",JSON.stringify(t))}),$("#tab .num").find("a").eq(1).on("click",function(){$(this).siblings("span").text(Number($(this).siblings("span").text())+1);for(var t=JSON.parse($.cookie("list")),a=0;a<t.length;a++)t[a].id==$(this).parents("tr").data("id")&&(t[a].num=$(this).siblings("span").text());$.cookie("list",JSON.stringify(t))})}});